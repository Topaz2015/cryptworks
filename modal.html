<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="css/bootstrap441.min.css" />
    <link type="text/css" rel="stylesheet" href="css/form.css" />
    <!-- <link rel="stylesheet" href="file/file.css"/> -->
    <link rel="stylesheet" href="toggle/bootstrap-toggle.min.css"/>
    <script type='text/javascript' src="modals/include.js"></script>
    <script type='text/javascript' src="js/crypto-js.min.js"></script>
    <script type='text/javascript' src="js/jquery341.min.js"></script>
    <script type='text/javascript' src="file/file.js"></script>
    <script type='text/javascript' src="toggle/bootstrap-toggle.min.js"></script>
    <script type='text/javascript' src="js/bootstrap441.min.js"></script>
    <script type='text/javascript' src="cryptlibyPaz.js"></script>
</head>
<body)>
    <div class="container mt-3">
        <div class="container txtout">
            <div class="row">
                <div class="col-sm-8  tabla">      
                    <input type="checkbox" data-toggle="toggle" id="cbToggle" 
                            data-off="Encrypt" data-on="Decrypt" 
                            data-onstyle="success" data-offstyle="info" data-width="100%">                  
                    <!-- Modal -->
                    <div w3-include-html="modals/encrypt.html"></div> 
                    <div w3-include-html="modals/decrypt.html"></div>
                    <script>includeHeader();</script>  
                </div>
                <!-- <div class="col-sm-4 tabla" id='rightside' style="display: none;">                        -->
                <div class="col-sm-4 tabla" id='rightside'>                        
                    <div class="container txtout" style="background-color: darkslategray;">
                            <div class="row">
                                <div class="col-sm-12 tabla">
                                    <div id='table_parent' class="table-responsive table-bordered table-hover table-condensed table-striped">
                                        <table class="table" id='restable' style=" color: aliceblue;">
                                            <p class="text-center">Output</p>
                                            <th>Name</th><th>Value</th>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <textarea name="outs" id="output"></textarea>
                        <button type="button" id="calculate"; style="background-color: darkslategray;">Calculate</button>
                        
                    </div>
                </div>
        </div>

        <script>
            var toggle = 0;
            $(document).ready(function() { 
                let pazky = 'The Lord is my shepherd'
                let pazln = 9
                //encrypting modal //JGTMP = 10+19+13+13+16 = 66
                $('#cbToggle').change(function() {
                    toggle ^= 1;
                    var enc = document.getElementById("encModal")      //$("#encModal")
                    var dec = document.getElementById("decModal") 
                    
                    if (enc.style.display === "none") {         //encryption
                        dec.style.display = "none";
                        enc.style.display = "block";
                        
                        $("#ewebsite").val("google.com");
                        $("#password").val("password");
                        $("#username").val("username");
                        $("#email").val("muigaipaz@gmail.com");
                        // $("#comment").val("Please enter description here...");
                        $("#elen").val(pazln);
                        $("#ekey").val(pazky);
                        $("#ecrypt").click(initEncryptor);   
                    } 
                    else {                                    //decryption
                        enc.style.display = "none";
                        dec.style.display = "block";
                        // $("#encstr").text('U2FsdGVkX1+k+4w5bc6KDRrd05uw7CmX0bigKP846HDwKgpTg7Hmyii1t5JEIGHatf98k3vtTkeV0m+lkFNwyA0a9m5sqk5vqNv/xcqbnb2jjafRYLi6uR3NgA0N6p1MrAxIRPejCHa3Ez4RzBWU2c6xNnCs1q2dNZYwGA4rzDa+Ox+1EVC6uQhGDEMkKmuWegkOECBU3creyEtaBY1PBh/1lBad4I2YHldSmNWGtwGAI1DHG1+SMWrSEiQem6VP+MJ3zMMknibzZelbW3QO0/KTgaY6f3iTNU4xO93JvsS0/0ybwhZZfopPOwV+QctjIOoA1moObKbMNiXEJqHskHY2nOcAgZoI5j3Q4urWh3DYewlARsP9gLlFXjQ8hE/XqBJVm1jGS+TR4Xu4KivP0KG+Y677EWe+3JkX1RqpdXt+n7+HTTOmJbe1lFXVlq1nSukhzxwYe/2eK1C+HsNkjRTVsDmoFcAHmAIfQ4l3E84U7+i1sb93mbUdRuaXVPb2i7W9GNLFriIPyeSVhcftmwqcQEu1g2NAuXOkOpDRuQFwnryO2APkCVQvOG/H4mm1AgnKqz5xjJWFS2wp+nHQ/IpbLFYQQO6C4F6PLymOjg2vHs9qKD1Q8VYRG95yfHt88D9WFvnKsRcREF27sHgw6tOwjXdT09cGmyrtFul/6yLTvmpIUgkFTnoz27EE7HGG1EJzYn2XSaLKXPmnelN78sMDs0FvG6LeKQqJellefLbUbJzbTm7fHA5HPGIHYxQs3UECz35hCgZ30sOfzoLCGuDnBvNLIf3Wo9hx1giOSfs=');          //.attr('readonly', 'readonly');
                        $("#dkey").val(pazky);          //.attr('readonly', 'readonly');
                        $("#dlen").val(pazln);          //.attr('readonly', 'readonly');
                        
                        $('#file').change(function(){
                            var decfile = $("#file").val();
                            var decfile = $("#file")[0].files[0];
                            var mtext = onFileUpload();
                            logc('this.id', this.id, 'magenta');
                            onFileUpload(this)              
                            logc('$(decfile)', decfile, 'magenta');
                            logc('text', mtext, 'cyan');              
                        });
                    }
                    $('#dcrypt').click(function(){
                        console.log('decrypt button pressed : ')
                        var decryptedArr = [];
                        var site = $("#dwebsite").val();
                        var encdstr = $("#encstr").val();
                        var key = $("#dkey").val();
                        var len = $("#dlen").val();      //PUK-53229651 -> 0708 407388  //4912
                        if (key.length > 0 && len !== NaN){
                            let obj2 = new CryptLibyPaz(key, len);
                            // if (site.length > 0) //
                            decryptedArr = obj2.decryptThis(encdstr);
                            // console.log('decryptedArr : ' + decryptedArr);
                            log('Modal.html decryptedArr', decryptedArr, "brown");
                            console.dir(decryptedArr);   
                        }
                            logc('decryptedArr', decryptedArr, 'cyan');                            
                            // logc('$(decfile)', decfile, 'magenta');
                        });                        
                    var cmnt = document.getElementById("comment")  
                
                })

                displayResults = (resArray) => {
                    var tab = document.getElementById('restable')
                    var rlen = tab.rows.length
                    logc('table rows', rlen, "orange");
                    for (let index = rlen-1; index > 0; index--) {       
                        logc('removing row', index, "white");
                        tab.deleteRow(index)                 
                    }
                    logc('table rows', tab.rows.length, "green");
                    // createNewTable()
                    resArray.forEach(element => {
                        var row = document.createElement('tr')
                        var dt1 = document.createElement('td')
                        var dt2 = document.createElement('td')
                        // logc('valwu ', element.value, "pink");
                        dt1.innerHTML = element.key
                        dt2.innerHTML = element.value
                        row.appendChild(dt1)
                        row.appendChild(dt2)
                        tab.appendChild(row)
                    });
                    document.getElementById('rightside').style = 'display: block;';
                    logc('table rows', tab.rows.length, "orange");
                }
                createInObj = (key, val) => {
                    var obj     = {};
                    obj.key     = key;
                    obj.value   = val;
                    return obj;
                }

                initEncryptor = () => {
                    var input = [];
                    var encryptedObj = {};
                    logc('Encrypting', '', 'orange')
                    input.push(createInObj('website', $("#ewebsite").val()));
                    input.push(createInObj('password', $("#password").val()));
                    input.push(createInObj('username', $("#username").val()));
                    input.push(createInObj('email', $("#email").val()));
                    input.push(createInObj('comment', $("#comment").val()));
                    var key = $("#ekey").val();
                    var len = $("#elen").val();      //PUK-53229651 -> 0708 407388
                    if (key.length > 0 && len !== NaN){
                        let obj = new CryptLibyPaz(key, len);
                        encryptedObj = obj.encryptThis(input);

                        // $("#btn-save").click( function() {
                        // var text = encryptedObj;
                        $('#output').val(encryptedObj)
                        // var filename = 'encryptedText'
                        // var blob = new Blob([text], {type: "text/plain;charset=utf-8"});
                        // saveAs(blob, filename+".txt");
                        // });
                    }
                    var site = $("#ewebsite").val()
                    site = site.slice(0, site.indexOf("."))
                    var name = $("#email").val()
                    name = name.slice(0, name.indexOf('@'))
                    console.log("adding you to github")
                    console.log(('%c(encryptedObj : ' + encryptedObj), 'color:#d5f');
                    console.dir(encryptedObj);
                        var link = document.createElement('a');
                        link.download = site + '.' +((name !== undefined)? name : '') +  '.json';
                        var blob = new Blob([encryptedObj], {type: 'text/plain'});
                        link.href = window.URL.createObjectURL(blob);
                        link.click();
                    console.log('check this out!!')
                }
                
            });
                
            loge = function(name, value) {
                // console.log('%cI %cam %cblack','color:red;','color:blue;', 'color: green;');
                // console.log('%cblack','color: red;');
                console.log('%c' + 'value', 'color:red;');
                console.dir(value);
            }

            logb = function(name, value) {
                console.log('OBJECT:' + name + ' = ' + value);
            }
            
            logc = function(title, value, color){
                // console.log('%c' + ('Object.values = ' + Object.values(itemObj)), 'color: #a2f');
                var col = 'color:' + color;
                var dat = title + ': ' + value;
                console.log(('%c' + dat), col);
            }



            $( "#calculate" ).click(function() {
                    console.log( "Handler for .keypress() called." );
                    const ky = $("#comment").val().toUpperCase() ;
                    // var out = $("#output").val();
                    let sum = 0, outText = "Sum= "
                    for (let i=0; i<ky.length; i++){
                        var y, fchar='', kc = ky.charCodeAt(i);
                        logc('ky', kc, 'orange')    
                        // logc('ky', x, 'green')
                        if (kc>64 && kc<91){
                            fchar += ky[i]
                            // logc('fchar', fchar, 'orange')
                            sum += kc - 64
                        }                        
                    }
                    let v = sum/49
                    outText += v
                    $("#output").val(outText)
                });    
                

        </script>
    </body>
</html>



    
     <!-- <table class="table" id='restable' style=" color: aliceblue;">
        //                             <p class="text-center">Output</p>
        //                             <th>Name</th><th>Value</th>
        //                         </table> -->
    <!-- createNewTable = () => {
        var table_parent = document.getElementById('table_parent')
        var oldtable = document.getElementById('restable')
        // table_parent.removeChild(oldtable)
        var newtable = document.createElement('table')
        newtable.setAttribute('id', 'restable')
        newtable.setAttribute('class', 'table')
        newtable.style = 'color: aliceblue;'
        var p = document.createElement('p')
        p.setAttribute('class', 'text-center')
        p.innerHTML = 'Output'
        var th1 = document.createElement('th')
        th1.innerHTML = 'Name'
        var th2 = document.createElement('th')
        th2.innerHTML = 'Value'
        newtable.appendChild(p)
        newtable.appendChild(th1)
        newtable.appendChild(th2)
        table_parent.appendChild(newtable)
    } -->